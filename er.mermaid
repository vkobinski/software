erDiagram
  COMPANY {
    ObjectId _id PK
    string name
    string domain
    object settings      
  }

  USER {
    ObjectId _id PK
    ObjectId companyId FK
    string name
    string email
    date   createdAt
  }

  INTEGRATION {
    ObjectId _id PK
    ObjectId companyId FK
    string name
    enum   type          
    string webhookUrl     
    object config         
    bool   active
  }

  FLOW {
    ObjectId _id PK
    ObjectId companyId FK
    ObjectId createdBy FK  
    string name
    date   createdAt
    bool   active
    array nodes    
    array edges     
  }

  FLOW ||--|{ NODE_EMBED : contains
  FLOW ||--|{ EDGE_EMBED : contains

  TEST_RUN {
    ObjectId _id PK
    ObjectId flowId FK
    date   runAt
    enum   status         
    string log
  }

  EXECUTION_LOG {
    ObjectId _id PK
    ObjectId flowId FK
    string nodeId        
    date   executedAt
    enum   status       
    object payload       
    object result       
  }

  COMPANY        ||--o{ USER          : "has"
  COMPANY        ||--o{ INTEGRATION   : "offers"
  COMPANY        ||--o{ FLOW          : "owns"
  USER           ||--o{ FLOW          : "creates"
  FLOW           ||--o{ TEST_RUN      : "tested_by"
  FLOW           ||--o{ EXECUTION_LOG : "logs"
  FLOW           ||--|{ INTEGRATION   : "via nodes[].integrationId"
